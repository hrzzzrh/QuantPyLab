# 项目操作手册

本文档记录 QuantPyLab 的所有运行指令及其参数说明。

### 1. 数据采集 (Data Ingestion)

#### 股票列表同步 (Basic Sync)
同步 A 股全量股票的基础代码与名称。
- **命令**: `uv run main.py --sync-stocks`
- **逻辑**: 
    1. 采用 **DELETE + append** 模式。
    2. 仅同步当前在市（Active）的股票。
- **建议频率**: 每周执行一次。
- **原因**: 保持数据库干净，仅包含当前可交易标的。
- **注意**: 历史退市股票目前不在同步范围内，`is_active` 字段对当前同步的股票默认均为 1。

#### 股票元数据补全 (Enrichment)
补全行业、地域、上市日期。
- **命令**: `uv run main.py --enrich-metadata [--limit N]`
- **策略**: 
    1. **Stage 1 (高速)**: 利用东财原生接口批量刷新行业信息。
    2. **Stage 2 (增量)**: 利用雪球和东财个股接口补全地域与上市日期。
- **建议频率**: 每次执行完 `--sync-stocks` 后执行，或每季度执行一次。
- **原因**: 行业分类和地域信息相对稳定，无需频繁更新。
- **性能**: 行业同步仅需约 1-2 分钟；详细信息补全视待处理数量而定（约 2-3 次请求/秒）。

### 财务报表同步
同步 A 股全量历史财务报表（资产负债表、利润表、现金流量表）。
- **命令**: `uv run main.py --sync-fin [--limit N] [--force-all]`
- **逻辑**: 
    1. **智能增量模式 (默认)**: 自动计算最近 4 个报告期，通过东财披露日历（沪深京全覆盖）识别已披露但本地缺失的股票进行抓取。
    2. **漏检补偿**: 自动识别从未同步过财报的“孤儿股”并优先同步。
    3. **强制全量**: 使用 `--force-all` 参数可忽略日历，强制检查全量股票的历史缺失情况。
    4. 采用单线程同步以保证 DuckDB Schema 动态扩展（ALTER TABLE）的安全性。
- **建议频率**: 每周执行一次 `uv run main.py --sync-fin` 即可自动追踪最新发布的财报。

### 财务指标同步 (Quant Indicators)
同步专业机构计算好的 140+ 个财务指标（如 ROE、毛利率、增长率等）。
- **命令**: `uv run main.py --sync-indicators [--limit N] [--symbol CODE]`
- **逻辑**: 
    1. **数据源**: 东方财富 (EM)。
    2. **存储规范**: 采用纯中文列名存储（基于 `em_indicator_dict.csv` 映射），列名经过规范化处理（去除单位、括号转下划线）。
    3. **更新策略**: 通过 `--symbol` 可同步指定单只股票；默认模式下会扫描全量股票进行补全。
- **价值**: 为量化因子分析提供现成的、高阶的盈利与成长性数据，无需手动计算 YoY/QoQ。
- **建议频率**: 在完成 `sync-fin` 之后执行，或者每月执行一次。

## 2. 环境维护
- **刷新 AI 上下文**: 在 Gemini CLI 中执行 `/memory refresh` 以加载最新的 `.gemini/GEMINI.md` 指令。
- **清理缓存**: (待添加)
