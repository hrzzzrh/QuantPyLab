# QuantPyLab 项目指南 (系统指令)
## 0.必须严格遵守开发核心原则
必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则

必须严格遵守开发核心原则
## 1. 项目定位
`QuantPyLab` 是一个基于 Python 的量化交易实验室，旨在实现从数据获取、存储、分析到回测的全流程闭环。

## 2. 文档管理体系
- **docs/**：反映系统当前现状（架构、规范、协议）。不记录开发历史。
- **workspace/**：存放开发中的设计稿、调研草案及临时记录。
- **绘图规范**：所有图表必须使用 **PlantUML** 语法。

## 3. 开发核心原则
1. **文档先行 (Docs-First Discovery)**：禁止直接搜索代码，必须首先阅读 `docs/`。
2. **提案与确认机制 (Proposal & Confirmation Protocol)**：严禁抢跑，复杂变更必须先在 `workspace/` 编写设计文档并获得“确认锁”，简单变更可以先在对话中提出提案并获得“确认锁”。
3. **数据怀疑论 (Data Skepticism)**：绝不假设两个数据源一致，必须实测采样。
4. **命名确定性 (Naming Precision)**：
    - **严禁模糊**：所有函数、类、变量及命令行指令名必须准确描述其职责。
    - **动宾结构**：指令名应遵循 `动作-对象` 规范。严禁使用 `all`, `export`, `data` 等过于宽泛的单词。例如：使用 `sync-all` 而非 `all`，使用 `export-views` 而非 `export`。
5. **统一视图架构 (Unified View Architecture)**：
所有数据查询必须通过视图完成。视图采用 Python 类定义 (`storage/database/views/`)，支持显式依赖 (DAG) 与自动可视化。
6. **运行规范**：本项目统一使用 `uv` 进行环境管理。执行脚本格式：`uv run main.py <subcommand> [options]`。

## 4. 项目进度
- [x] **基础架构搭建**：完成 `uv` 环境配置，实现 SQLite/DuckDB 双引擎。
- [x] **存储架构升级 (Data Lake)**：实现 Parquet 分片存储与存算分离。
- [x] **统一视图架构**：实现 Code-as-Definition 模式，支持 DAG 加载与 PlantUML 拓扑可视化。
- [x] **股票元数据补全**：实现行业、地域、上市日期多源补全。
- [x] **财务/指标同步**：实现披露日历驱动的智能增量同步。
- [x] **财务 TTM 计算引擎**：实现自主计算无穿越的滚动财务指标。
- [x] **日线 K 线同步引擎**：实现增量行情采集与复权因子自动计算。
- [x] **CLI 系统重构**：实现基于子命令的标准化命令行入口。

## 5. 后续计划
- [ ] **回测引擎基础建设**：构建基于 SQL 选股与复权价格计算的轻量级回测框架。
- [ ] **因子库扩展**：利用 DuckDB 窗口函数在 SQL 层实现技术指标 (MA, MACD 等)。
- [ ] **自动化调度**：整合全流程同步任务。

## 6. 文档维护规范
- **功能完备性 (Definition of Done)**：
    1. **价值沉淀**：评估 `workspace/` 文档重要性，仅将具有长期参考价值的文档转入 `docs/`。
    2. **文档演进**：优先更新 `docs/` 现有文档以反映现状，仅在涉及全新领域时新建。
    3. **清理**：删除 `workspace/` 中的开发痕迹、临时脚本及过时设计方案。
    4. **规范同步**：确保 `usage.md` 等关键文档与最新代码逻辑、指令集保持一致。
    5. **精准提交**：执行 `git add` 必须精确到文件，严禁使用 `git add .`。
- **刷新机制**：修改本文件后，提醒执行 `/memory refresh`。