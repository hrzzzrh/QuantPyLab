# 财务指标同步引擎设计文档 (Finance Indicators) - V3 (最终确认版)

## 1. 目标与价值
构建基于**东方财富 (EM)** 的全维度财务指标库。

**核心决策：**
- **单一数据源**：放弃新浪合并逻辑，采用东财 (EM) 作为唯一数据源，确保量化因子的稳定性与计算标准的一致性。
- **中文列名存储**：库内表 `fin_indicator` 统一采用中文列名（如 `净资产收益率_加权`），与三大报表风格对齐。
- **ETL 映射**：通过 `em_indicator_dict.csv` 将东财的英文缩写 Key 转换为易读的中文描述。

## 2. 数据字典 (ETL Mapping)
- **文件**：`workspace/em_indicator_dict.csv`
- **作用**：仅作为采集时的翻译表。
- **处理规范**：去除列名中的 `(元)`、`(%)`、`(次)`、`(天)` 等单位后缀，保留核心含义后缀（如 `_加权`、`_同比增长`）。

## 3. 存储层设计 (IndicatorStore)
- **数据库**：`analysis.duckdb`
- **表名**：`fin_indicator`
- **列式优化**：采用动态列扩展模式，支持不同行业特有指标的自动扩充。
- **Upsert 策略**：基于 `(symbol, report_date)` 先删除后插入。

## 4. 采集逻辑
- **接口**：`ak.stock_financial_analysis_indicator_em`。
- **增量策略**：
    1. **披露驱动**：配合 `main.py` 的披露日历逻辑同步。
    2. **补全驱动**：扫描已有三大报表但缺失指标的股票进行补全。

## 5. 待办事项
- [x] 更新指标字典字典 (140个指标全覆盖)。
- [x] 实现 `IndicatorStore` 存储逻辑。
- [x] 集成 `FinancialCollector` 采集转换逻辑。
- [ ] **(待执行)** 在 `main.py` 注册 `sync-fin-indicator` 指令。
- [ ] **(待执行)** 进行单股同步测试验证。
